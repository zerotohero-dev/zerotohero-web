<!doctype html><html dir=auto lang=en><head><meta charset=utf-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="index, follow" name=robots><title>Securing CI/CD Access to Your Secrets Management System: An Architectural Analysis</title><meta content="architecture, development, hacker-culture" name=keywords><meta content="Securing CI/CD Access to Your Secrets Management System: An Architectural Analysis" name=description><meta content="Volkan Özçelik" name=author><link href=https://zerotohero.dev/inbox/dedicated-oidc-server/ rel=canonical><link href=https://zerotohero.dev/css/includes/scroll-bar.css rel=stylesheet><link href=https://zerotohero.dev/css/styles.css rel=stylesheet><link href=https://zerotohero.dev/css/override.css rel=stylesheet><link href=https://zerotohero.dev/atom.xml rel=alternate title=RSS type=application/atom+xml><noscript><style>#theme-toggle,.top-link{display:none}</style> <style>@media (prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:#dadadb;--secondary:#9b9c9d;--tertiary:#414244;--content:#c4c4c5;--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><body id=top><script>if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }</script><script src=https://player.vimeo.com/api/player.js></script><header class=header><nav class=nav><div class=logo><a title="Zero to Hero (Alt + H)" accesskey=h href=https://zerotohero.dev> <svg viewbox="-0.5 -0.5 32 32" height=32 id=High-Voltage--Streamline-Kawaii-Emoji style=position:relative;top:2px;left:4px width=32 xmlns=http://www.w3.org/2000/svg><desc>High Voltage Streamline Emoji: https://streamlinehq.com</desc><path d="M16.244 18.21002a56.048 56.048 0 0 1 -8.1313 -0.8853599999999999 3.3480000000000003 3.3480000000000003 0 0 1 -2.3374 -4.7802C6.500699999999999 11.097999999999999 16.04994 3.35854 21.79548 1.2059a1.14328 1.14328 0 0 1 1.36772 1.68392c-1.2183 1.8599999999999999 -3.5340000000000003 4.0641 -7.88702 8.56716 1.98772 0.124 4.207319999999999 -0.093 6.55216 -0.07688a3.66172 3.66172 0 0 1 3.0534999999999997 1.3813600000000001c0.6975 0.9734 0.97898 2.33058 0.32674000000000003 3.3356 -1.54504 2.37894 -9.10284 9.4054 -13.52468 12.80362 -1.5741800000000001 1.2096200000000001 -2.7565199999999996 1.27596 -3.41 0.26226 -0.39742 -0.6169 0.18166 -1.32618 0.5251399999999999 -1.8258999999999999C10.185979999999999 25.320800000000002 16.182000000000002 18.20754 16.244 18.21002z" fill=#ffe500 stroke-width=1></path><path d="M24.881839999999997 12.76146a3.66172 3.66172 0 0 0 -3.0534999999999997 -1.3813600000000001 52.95544 52.95544 0 0 0 -1.9734599999999998 0.03038 3.472 3.472 0 0 1 2.54696 1.3509799999999998c0.6975 0.9734 0.9796 2.33058 0.32674000000000003 3.3356 -1.5444200000000001 2.37894 -9.10284 9.40478 -13.52468 12.80362a6.66996 6.66996 0 0 1 -0.744 0.496c0.682 0.75144 1.78498 0.6107 3.2209000000000003 -0.496 4.424939999999999 -3.3988400000000003 11.98336 -10.42468 13.52778 -12.80362 0.65286 -1.00502 0.37076 -2.3622 -0.32674000000000003 -3.3356zM20.6832 2.88982c-1.16498 1.77816 -3.3368399999999996 3.87314 -7.33026 7.9918000000000005a0.35773999999999995 0.35773999999999995 0 0 0 0.248 0.60698c0.65596 0.01302 1.33486 0 2.0292600000000003 -0.02294 -0.11656 -0.00496 -0.23994000000000001 0 -0.35525999999999996 -0.00868 4.34 -4.495 6.66066 -6.700340000000001 7.88082 -8.556000000000001a1.1457600000000001 1.1457600000000001 0 0 0 -1.35904 -1.69446c-0.3565 0.1333 -0.7285 0.28892 -1.11104 0.46252a1.09802 1.09802 0 0 1 -0.00248 1.22078z" fill=#f2c100 stroke-width=1></path><path d="M16.244 18.21002a56.048 56.048 0 0 1 -8.1313 -0.8853599999999999 3.3480000000000003 3.3480000000000003 0 0 1 -2.3374 -4.7802C6.500699999999999 11.097999999999999 16.04994 3.35854 21.79548 1.2059a1.14328 1.14328 0 0 1 1.36772 1.68392c-1.2183 1.8599999999999999 -3.5340000000000003 4.0641 -7.88702 8.56716 1.98772 0.124 4.207319999999999 -0.093 6.55216 -0.07688a3.66172 3.66172 0 0 1 3.0534999999999997 1.3813600000000001c0.6975 0.9734 0.97898 2.33058 0.32674000000000003 3.3356 -1.54504 2.37894 -9.10284 9.4054 -13.52468 12.80362 -1.5741800000000001 1.2096200000000001 -2.7565199999999996 1.27596 -3.41 0.26226 -0.39742 -0.6169 0.18166 -1.32618 0.5251399999999999 -1.8258999999999999C10.185979999999999 25.320800000000002 16.182000000000002 18.20754 16.244 18.21002z" fill=none stroke=#45413c stroke-linecap=round stroke-linejoin=round stroke-width=1></path></svg> Zero to Hero </a><div class=logo-switches><button title="(Alt + T)" accesskey=t id=theme-toggle><svg viewbox="0 0 24 24" fill=none height=18 id=moon stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> <svg viewbox="0 0 24 24" fill=none height=18 id=sun stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><circle cx=12 cy=12 r=5></circle><line x1=12 x2=12 y1=1 y2=3></line><line x1=12 x2=12 y1=21 y2=23></line><line x1=4.22 x2=5.64 y1=4.22 y2=5.64></line><line x1=18.36 x2=19.78 y1=18.36 y2=19.78></line><line x1=1 x2=3 y1=12 y2=12></line><line x1=21 x2=23 y1=12 y2=12></line><line x1=4.22 x2=5.64 y1=19.78 y2=18.36></line><line x1=18.36 x2=19.78 y1=5.64 y2=4.22></line></svg></button><ul class=lang-switch><li></ul></div></div><ul id=menu><li><a href=/about title=About> <span>About</span> </a><li><a href=/archive title=Archive> <span>Archive</span> </a><li><a href=/tags title=Tags> <span>Tags</span> </a><li><a title="Vadideki Geyik" href=https://vadidekigeyik.com> <span>Vadideki Geyik</span> <svg viewbox="0 0 24 24" fill=none height=12 shape-rendering=geometricPrecision stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2.5 width=12><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path><path d="M15 3h6v6"></path><path d="M10 14L21 3"></path></svg> </a><li><a href=https://discord.gg/kampus title=kamp.us> <span>kamp.us</span> <svg viewbox="0 0 24 24" fill=none height=12 shape-rendering=geometricPrecision stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2.5 width=12><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path><path d="M15 3h6v6"></path><path d="M10 14L21 3"></path></svg> </a><li><a href=https://github.com/spiffe/spike title=SPIKE> <span>SPIKE</span> <svg viewbox="0 0 24 24" fill=none height=12 shape-rendering=geometricPrecision stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2.5 width=12><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path><path d="M15 3h6v6"></path><path d="M10 14L21 3"></path></svg> </a></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://zerotohero.dev>Home</a> »  <a href=https://zerotohero.dev/>Posts</a> »  <a href=https://zerotohero.dev/inbox/dedicated-oidc-server/>Securing CI/CD Access to Your Secrets Management System: An Architectural Analysis</a></div><h1 class=post-title>Securing CI/CD Access to Your Secrets Management System: An Architectural Analysis</h1><div class=post-description>Securing CI/CD Access to Your Secrets Management System: An Architectural Analysis</div><div class=post-meta><span title="2024-11-27 00:00:00 +0000">2024-11-27</span> · 4 min · Volkan Özçelik</div></header><div class=toc><details><summary title="(Alt + C)" accesskey=c><span class=details>Table of Contents</span></summary> <div class=inner><ul><li><a aria-label="The Base Architecture" href=#the-base-architecture>The Base Architecture</a><li><a aria-label="The Challenge" href=#the-challenge>The Challenge</a><li><a aria-label="Solution Options" href=#solution-options>Solution Options</a> <ul><li><a aria-label="1. Extend Pilot as an OIDC Resource Server" href=#1-extend-pilot-as-an-oidc-resource-server>1. Extend Pilot as an OIDC Resource Server</a><li><a aria-label="2. Create a Dedicated OIDC Resource Server" href=#2-create-a-dedicated-oidc-resource-server>2. Create a Dedicated OIDC Resource Server</a><li><a aria-label="3. Expose Nexus as an OIDC Resource Server" href=#3-expose-nexus-as-an-oidc-resource-server>3. Expose Nexus as an OIDC Resource Server</a></ul><li><a aria-label="Recommended Approach" href=#recommended-approach>Recommended Approach</a> <ul><li><a aria-label="Security Benefits" href=#security-benefits>Security Benefits</a><li><a aria-label="Architectural Benefits" href=#architectural-benefits>Architectural Benefits</a><li><a aria-label="Operational Benefits" href=#operational-benefits>Operational Benefits</a></ul><li><a aria-label="Implementation Considerations" href=#implementation-considerations>Implementation Considerations</a><li><a aria-label=Conclusion href=#conclusion>Conclusion</a></ul></div></details></div><div class=post-content><p>When building a secrets management system, one of the key challenges is providing secure automated access for CI/CD pipelines while maintaining strong security boundaries. In this post, we’ll explore different architectural approaches to solving this problem, analyzing their trade-offs and providing recommendations.<h2 id=the-base-architecture>The Base Architecture</h2><p>Before diving into the solutions, let’s understand our starting point. The existing system consists of two main components:<ol><li><strong>Pilot</strong>: A CLI tool that provides user access to secrets<li><strong>Nexus</strong>: The secure storage backend for secrets</ol><p>The communication between these components uses SPIFFE mTLS over REST, providing strong security guarantees and identity-based access control.<h2 id=the-challenge>The Challenge</h2><p>While this architecture works well for human operators using the CLI, we need to provide automated access for CI/CD pipelines. This requires exposing a RESTful interface that can be consumed by automation tools while maintaining our security posture.<h2 id=solution-options>Solution Options</h2><h3 id=1-extend-pilot-as-an-oidc-resource-server>1. Extend Pilot as an OIDC Resource Server</h3><p>In this approach, we would enhance the existing Pilot component to serve as an OIDC resource server, allowing it to handle automated requests alongside its CLI duties.<p><strong>Advantages:</strong><ul><li>Reuses existing, trusted component<li>Maintains current security boundary where only Pilot talks to Nexus<li>Preserves existing SPIFFE mTLS security model<li>Reduces operational complexity by not adding new components</ul><p><strong>Disadvantages:</strong><ul><li>Mixes different concerns in one component<li>Complicates Pilot’s codebase and testing<li>May require significant architectural changes to Pilot<li>Could impact CLI performance and reliability<li>Makes future changes more complex</ul><h3 id=2-create-a-dedicated-oidc-resource-server>2. Create a Dedicated OIDC Resource Server</h3><p>This solution involves building a new component specifically designed to handle CI/CD automation requests, essentially acting as a Pilot analog for automated access.<p><strong>Advantages:</strong><ul><li>Clean separation of concerns<li>Purpose-built for CI/CD integration needs<li>Independent scaling and maintenance<li>Can implement specific rate limiting and security controls<li>Separate logging and auditing for automated access<li>Easier to evolve and maintain<li>Can be optimized for automated workflows</ul><p><strong>Disadvantages:</strong><ul><li>New component to maintain and monitor<li>Need to implement SPIFFE mTLS client functionality<li>Additional operational overhead<li>Initial development investment</ul><h3 id=3-expose-nexus-as-an-oidc-resource-server>3. Expose Nexus as an OIDC Resource Server</h3><p>The third option involves modifying Nexus to directly handle automated requests as an OIDC resource server.<p><strong>Advantages:</strong><ul><li>Potentially simpler architecture<li>Direct access to secrets store<li>Fewer network hops</ul><p><strong>Disadvantages:</strong><ul><li>Breaks single-responsibility principle<li>Increases attack surface of critical secrets store<li>Complicates Nexus’s security model<li>Makes storage backend changes more difficult<li>Violates the principle of least privilege</ul><h2 id=recommended-approach>Recommended Approach</h2><p>After careful analysis, creating a dedicated OIDC resource server (Option 2) emerges as the most robust solution. Here’s why:<h3 id=security-benefits>Security Benefits</h3><ul><li>Maintains existing security boundaries<li>Allows for fine-grained access control specific to automation<li>Keeps Nexus protected behind SPIFFE mTLS<li>Enables separate security policies for automated access</ul><h3 id=architectural-benefits>Architectural Benefits</h3><ul><li>Clean separation of concerns<li>Independent scaling and evolution<li>Dedicated logging and monitoring<li>Easier to maintain and modify</ul><h3 id=operational-benefits>Operational Benefits</h3><ul><li>Can implement automation-specific features<li>Independent deployment and updates<li>Separate rate limiting and throttling<li>Dedicated audit trails for automated access</ul><h2 id=implementation-considerations>Implementation Considerations</h2><p>When implementing the dedicated OIDC resource server approach, consider:<ol><li><p><strong>Authentication</strong>:</p> <ul><li>Implement robust OIDC client authentication<li>Consider additional authentication methods for different CI/CD platforms<li>Implement proper token validation and management</ul><li><p><strong>Authorization</strong>:</p> <ul><li>Define clear RBAC policies for CI/CD access<li>Implement fine-grained access control<li>Consider environment-based restrictions</ul><li><p><strong>Security</strong>:</p> <ul><li>Implement rate limiting<li>Add robust audit logging<li>Consider request validation and sanitization<li>Implement proper error handling that doesn’t leak sensitive information</ul><li><p><strong>Monitoring</strong>:</p> <ul><li>Add detailed operational metrics<li>Implement automated access pattern analysis<li>Set up alerting for suspicious activities</ul></ol><h2 id=conclusion>Conclusion</h2><p>While all three approaches could work, creating a dedicated OIDC resource server provides the best balance of security, maintainability, and flexibility. It allows for proper separation of concerns while maintaining strong security boundaries and enables independent evolution of human and automated access patterns.<p>This solution might require more initial development effort, but the long-term benefits in terms of security, maintainability, and operational flexibility make it the most robust choice for production environments.</div><footer class=post-footer><ul class=post-tags><li><a href=https://zerotohero.dev/tags/spike/>SPIKE</a><li><a href=https://zerotohero.dev/tags/inbox/>inbox</a><li><a href=https://zerotohero.dev/tags/secrets-management/>secrets-management</a><li><a href=https://zerotohero.dev/tags/security/>security</a><li><a href=https://zerotohero.dev/tags/architecture/>architecture</a><li><a href=https://zerotohero.dev/tags/authentication/>authentication</a><li><a href=https://zerotohero.dev/tags/development/>development</a><li><a href=https://zerotohero.dev/tags/networking/>networking</a><li><a href=https://zerotohero.dev/tags/productivity/>productivity</a><li><a href=https://zerotohero.dev/tags/spiffe/>SPIFFE</a><li><a href=https://zerotohero.dev/tags/spire/>SPIRE</a></ul><nav class=paginav></nav></footer></article></main><footer class=footer><span>© <a href=https://zerotohero.dev>Volkan Özçelik</a> and <a href=https://vadidekigeyik.com/>Team Geyik</a></span><br><br> The content on this website is distributed under a <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en>CC-BY-NC-SA 4.0 license</a>.<br><br><a href=/about/privacy>Privacy Policy</a> | <a href=/about/contact>Contact</a><br><br><br></footer><a aria-label="go to top" title="Go to Top (Alt + G)" accesskey=g class=top-link href=#top id=top-link> <svg viewbox="0 0 12 6" fill=currentColor xmlns=http://www.w3.org/2000/svg><path d="M12 6H0l6-6z"/></svg> </a><script>let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });</script><script>var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };</script><script>document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })</script><script>document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';
        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                var content = codeblock.textContent;
                if(codeblock.firstChild.tagName == 'TABLE') {
                    content = Array(...codeblock.firstChild.getElementsByTagName('span')).map((span) => { return span.textContent; }).join('');
                }
                navigator.clipboard.writeText(content);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            // td containing LineNos
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            // table containing LineNos and code
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            // code blocks not having highlight as parent class
            codeblock.parentNode.appendChild(copybutton);
        }
    });</script>